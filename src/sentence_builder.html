<!DOCTYPE html>

<html>
  <head>
    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    
    <!-- Bootstrap -->
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <!-- Hangul.js library -->
    <script src="https://unpkg.com/hangul-js" type="text/javascript"></script>

    <!-- Analytics -->
    <script type="text/javascript">
      if (window.location.href.includes('github')) {
        $.post('https://maksimkorzh.pythonanywhere.com/analytics/api/post', {
          date: new Date,
          url: window.location.href
        });
      }
    </script>
  </head>
  <body>
    <!-- Screen keboard -->
    <div id="keyboard" align="center" class="mt-2">
      <!-- Word order hint -->
      <div class="mb-3 text-center" style="width: 495px;">
        <span class="badge badge-danger">Subject</span>
        <span class="badge badge-warning">Time</span>
        <span class="badge badge-secondary">Place</span>
        <span class="badge badge-success">Object</span>
        <span class="badge badge-info">Adverb</span>
        <span class="badge badge-primary">Verb</span>
      </div>
      <textarea autofocus id="hangul-text" rows="10" style="width: 495px; font-size: 20px;" onkeydown="physicalKeyboardInput();"></textarea>
      <div class="m-0 p-0" style="width: 500px;">
        <div class="btn-group mt-2 mx-auto">
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">1</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">2</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">3</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">4</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">5</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">6</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">7</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">8</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">9</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">0</button>
        </div>
        <div class="btn-group mt-2 mx-auto">
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅃ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅉ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㄸ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㄲ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅆ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅒ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅖ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">-</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">:</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">"</button>
        </div>
        <div class="btn-group mt-2 mx-auto">
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅂ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅈ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㄷ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㄱ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅅ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅛ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅕ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅑ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅐ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅔ</button>
        </div>
        <div class="btn-group mt-2 mx-auto">
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅁ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㄴ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅇ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㄹ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅎ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅗ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅓ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅏ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅣ</button>
                <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">!</button>
        </div>
        <div class="btn-group mt-2 mx-auto">
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅋ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅌ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅊ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅍ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅠ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅜ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1">ㅡ</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">,</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">.</button>
          <button onclick="screenKeyboardInput(this);" class="btn btn-outline-secondary ml-1 mr-1" style="width: 42px;">?</button>
        </div>
        <div class="btn-group mt-2 mx-auto" style="width: 500px;">
          <button onclick="screenKeyboardInput(this);" class="col btn btn-outline-secondary ml-1 mr-1">Space</button>
          <button onclick="screenKeyboardInput(this);" class="col btn btn-outline-secondary ml-1 mr-1">Enter</button>
          <button onclick="screenKeyboardBackspace(this);" class="col btn btn-outline-secondary ml-1 mr-1">Backspace</button>
        </div>
      </div>
    </div>

    <!-- Main script -->
    <script>
      const HANGUL = {
        'q': 'ㅂ',
        'w': 'ㅈ',
        'e': 'ㄷ',
        'r': 'ㄱ',
        't': 'ㅅ',
        'y': 'ㅛ',
        'u': 'ㅕ',
        'i': 'ㅑ',
        'o': 'ㅐ',
        'p': 'ㅔ',
        'a': 'ㅁ',
        's': 'ㄴ',
        'd': 'ㅇ',
        'f': 'ㄹ',
        'g': 'ㅎ',
        'h': 'ㅗ',
        'j': 'ㅓ',
        'k': 'ㅏ',
        'l': 'ㅣ',
        'z': 'ㅋ',
        'x': 'ㅌ',
        'c': 'ㅊ',
        'v': 'ㅍ',
        'b': 'ㅠ',
        'n': 'ㅜ',
        'm': 'ㅡ',
        'Q': 'ㅃ',
        'W': 'ㅉ',
        'E': 'ㄸ',
        'R': 'ㄲ',
        'T': 'ㅆ',
        'O': 'ㅒ',
        'P': 'ㅖ',
      };
      
      // always type text at cursor position
      function insertAtCursor(textArea, userInput) {
        if (textArea.selectionStart || textArea.selectionStart == '0') {
          var startPos = textArea.selectionStart;
          var endPos = textArea.selectionEnd;
          textArea.value = textArea.value.substring(0, startPos)
            + userInput
            + textArea.value.substring(endPos, textArea.value.length);
        }

        return endPos;
      }
      
      // handle user input from physical keyboard
      function physicalKeyboardInput() {
        // extract pressed key
        let key = window.event.key;
        
        // if corresponding character exists
        if (HANGUL[key] && window.event.ctrlKey == false) {
          // hack to avoid printing roman letters
          window.event.preventDefault();
          
          // extract textarea DOM element
          let text = document.getElementById('hangul-text');
          
          // input hangul characters instead of roman characters
          let pos = insertAtCursor(text, HANGUL[key]);
          
          // disassemble characters
          let parsed = Hangul.disassemble(text.value);

          // assemble characters
          text.value = Hangul.assemble(parsed);
          
          // adjust cursor position
          if (text.value.length - pos > 1)
            text.selectionEnd = text.value[pos] == ' ' ? pos : pos + 1;
        }
      }
      
      // handle user input from screen keyboard
      function screenKeyboardInput(button) {
        // extract button character
        let key = button.innerHTML.replace('Space', ' ').replace('Enter', '\n');
        
        // extract textarea DOM element
        let text = document.getElementById('hangul-text');

        // force focus on textarea
        text.focus();
        
        // input hangul characters from screen keyboard
        let pos = insertAtCursor(text, key);

        // disassemble characters
        let parsed = Hangul.disassemble(text.value);

        // assemble characters
        text.value = Hangul.assemble(parsed);
        
        // adjust cursor position
        if (text.value.length - pos > 1)
          text.selectionEnd = (text.value[pos] == ' ' && button.innerHTML != 'Space') ? pos : pos + 1;
      }
      
      // handle backspace
      function screenKeyboardBackspace() {
        // extract textarea DOM element
        let text = document.getElementById('hangul-text');

        // force focus on textarea
        text.focus();
        
        // current cursor position
        var startPos = text.selectionStart;
        var endPos = text.selectionEnd;
          
        // erase character
        text.value = text.value = text.value.substring(0, startPos - 1) +
                                      text.value.substring(endPos, text.value.length);
        
        // adjust cursor position
        text.selectionEnd = startPos - 1;
      }
      
    </script>
  </body>
</html>










